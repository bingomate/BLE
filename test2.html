<html>
<body>
<button onclick="connect()">Connect to Web Bluetooth</button>
<div id="data"></div>
<script>
const bleNusServiceUUID  = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
function connect() {
  var options =  {
   //filters: [{services: []}]
        optionalServices: [bleNusServiceUUID],
        acceptAllDevices: true
  };
  var busy = false;
  var gatt, service, service2;
  // Bring up the Web Bluetooth Device Chooser
  navigator.bluetooth.requestDevice(options).then(function(device) {
    console.log('Device: ' + JSON.stringify(device));
    return device.gatt.connect();
  }).then(function(g) {
   gatt = g;
   // Get our custom service
   return gatt.getPrimaryService("6e400001-b5a3-f393-e0a9-e50e24dcca9e");
  }).then(function(service) {
    // Get the Notification (RX service for Nordic UART)
    //return service.getCharacteristic("6e400002-b5a3-f393-e0a9-e50e24dcca9e");
    return service.getCharacteristic("6e400003-b5a3-f393-e0a9-e50e24dcca9e");
     var dataDiv = document.querySelector("#data");
    // When we get a notification, write the data to a div below the button
    characteristic.addEventListener('characteristicvaluechanged', function(event) {
      var value = event.target.value.buffer; // an arraybuffer
      dataDiv.textContent = (new Int8Array(value)).toString();
    });

  }).then(function(characteristic) {
    // Now start getting notifications
    return characteristic.startNotifications();
  }).then(function() {
    //gatt.disconnect();
    console.log("Waiting for Notifications");

  }).catch(function(error) {
    console.log("Something went wrong. " + error);
  }).then(function(service2) {
    return service2.getCharacteristic("6e400002-b5a3-f393-e0a9-e50e24dcca9e");
  }).then(function(characteristic) {
        var rgb = new Uint8Array([
    	    44,
    	    44,
    	    23]
          );
     return characteristic.writeValue(rgb);
  })

}

</script>
</body>
</html>
